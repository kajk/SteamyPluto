<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<title>Local Record and Replay</title>
</head>
<body>
<video id="video"></video>
<button id="startbutton">Start Record</button>
<button id="stopbutton">End Record</button>
<canvas id="canvas"></canvas> 
<hr/>
<div id="output"></div>
<script type="text/javascript">
(function() {
  var startbutton = document.querySelector("#startbutton"),
      stopbutton = document.querySelector("#stopbutton"),
      video = document.querySelector("#video"),
      mediaRecorder = null,
      mediaConstraints = { audio:true, video:true };

var output = document.querySelector("#output");

  stopbutton.disabled = true;

  navigator.getMedia = ( navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia ||
                         navigator.msGetUserMedia);

  startbutton.onclick = function() {
    this.disabled = true;
    stopbutton.disabled = false;
    navigator.getMedia(mediaConstraints, onMediaSuccess, onMediaError);
  }

  stopbutton.onclick = function() {
    this.disabled = true;
    startbutton.disabled = false;
    if (!!mediaRecorder) {
      mediaRecorder.stop();
    }
  }

  function onMediaSuccess(stream) {
    video.controls = true;
    video.width = 320;
    video.height = 240;
    video.src = URL.createObjectURL(stream);

    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.mimeType = 'video/webm';
    mediaRecorder.videoWidth = 320;
    mediaRecorder.videoHeight = 240;
    mediaRecorder.ondataavailable = function(e) {
      console.log("data available");
      b = new Blob([e.data], { type: e.data.type });

      var a = document.createElement("a");
      a.target = "_blank";
      a.innerHTML = "Open Recorded Video"
      a.href = URL.createObjectURL(b);
      output.appendChild(a);
    }

    mediaRecorder.start();
    video.play();
  }

  function onMediaError(error) {
    console.error("media error", error)
  }
})();
</script>
</body>
</html>
